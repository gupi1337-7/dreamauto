var ExtPay=function(){"use strict";var e,s,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(s={exports:{}},(e=function(e,s){var r,t;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(t=function(e){if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw Error("This script should only be loaded in a browser extension.");e.exports=(e=>{let s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(s).length)throw Error("api-metadata.json has not been included in browser-polyfill");class r extends WeakMap{constructor(e,s){super(s),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}let t=e=>e&&"object"==typeof e&&"function"==typeof e.then,a=(s,r)=>(...t)=>{e.runtime.lastError?s.reject(e.runtime.lastError):r.singleCallbackArg||t.length<=1&&!1!==r.singleCallbackArg?s.resolve(t[0]):s.resolve(t)},n=e=>1==e?"argument":"arguments",i=(e,s)=>function r(t,...i){if(i.length<s.minArgs)throw Error(`Expected at least ${s.minArgs} ${n(s.minArgs)} for ${e}(), got ${i.length}`);if(i.length>s.maxArgs)throw Error(`Expected at most ${s.maxArgs} ${n(s.maxArgs)} for ${e}(), got ${i.length}`);return new Promise((r,n)=>{if(s.fallbackToNoCallback)try{t[e](...i,a({resolve:r,reject:n},s))}catch(g){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),t[e](...i),s.fallbackToNoCallback=!1,s.noCallback=!0,r()}else s.noCallback?(t[e](...i),r()):t[e](...i,a({resolve:r,reject:n},s))})},g=(e,s,r)=>new Proxy(s,{apply:(s,t,a)=>r.call(t,e,...a)}),o=Function.call.bind(Object.prototype.hasOwnProperty),m=(e,s={},r={})=>{let t=Object.create(null),a=Object.create(e);return new Proxy(a,{has:(s,r)=>r in e||r in t,get(a,n,l){if(n in t)return t[n];if(!(n in e))return;let A=e[n];if("function"==typeof A){if("function"==typeof s[n])A=g(e,e[n],s[n]);else if(o(r,n)){let c=i(n,r[n]);A=g(e,e[n],c)}else A=A.bind(e)}else if("object"==typeof A&&null!==A&&(o(s,n)||o(r,n)))A=m(A,s[n],r[n]);else{if(!o(r,"*"))return Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:()=>e[n],set(s){e[n]=s}}),A;A=m(A,s[n],r["*"])}return t[n]=A,A},set:(s,r,a,n)=>(r in t?t[r]=a:e[r]=a,!0),defineProperty:(e,s,r)=>Reflect.defineProperty(t,s,r),deleteProperty:(e,s)=>Reflect.deleteProperty(t,s)})},l=e=>({addListener(s,r,...t){s.addListener(e.get(r),...t)},hasListener:(s,r)=>s.hasListener(e.get(r)),removeListener(s,r){s.removeListener(e.get(r))}}),A=!1,c=new r(e=>"function"!=typeof e?e:function s(r,a,n){let i=!1,g,o=new Promise(e=>{g=function(s){A||(console.warn("Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",Error().stack),A=!0),i=!0,e(s)}}),m;try{m=e(r,a,g)}catch(l){m=Promise.reject(l)}let c=!0!==m&&t(m);return(!0===m||!!c||!!i)&&((e=>{e.then(e=>{n(e)},e=>{let s;s=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:s})}).catch(e=>{console.error("Failed to send onMessage rejected reply",e)})})(c?m:o),!0)}),x=({reject:s,resolve:r},t)=>{e.runtime.lastError?"The message port closed before a response was received."===e.runtime.lastError.message?r():s(e.runtime.lastError):t&&t.__mozWebExtensionPolyfillReject__?s(Error(t.message)):r(t)},u=(e,s,r,...t)=>{if(t.length<s.minArgs)throw Error(`Expected at least ${s.minArgs} ${n(s.minArgs)} for ${e}(), got ${t.length}`);if(t.length>s.maxArgs)throw Error(`Expected at most ${s.maxArgs} ${n(s.maxArgs)} for ${e}(), got ${t.length}`);return new Promise((e,s)=>{let a=x.bind(null,{resolve:e,reject:s});t.push(a),r.sendMessage(...t)})},_={runtime:{onMessage:l(c),onMessageExternal:l(c),sendMessage:u.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:u.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},d={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":d},services:{"*":d},websites:{"*":d}},m(e,_,s)})(chrome)}else e.exports=browser})(e)})(s,s.exports),s.exports);return"undefined"!=typeof window&&window.addEventListener("message",e=>{"https://extensionpay.com"===e.origin&&e.source==window&&("fetch-user"===e.data||"trial-start"===e.data)&&t.runtime.sendMessage(e.data)},!1),function e(s){let r="https://extensionpay.com",a=`${r}/extension/${s}`;function n(e){return new Promise(s=>setTimeout(s,e))}async function i(e){try{return await t.storage.sync.get(e)}catch(s){return await t.storage.local.get(e)}}async function g(e){try{return await t.storage.sync.set(e)}catch(s){return await t.storage.local.set(e)}}t.management&&t.management.getSelf().then(async e=>{if(!e.permissions.includes("storage")){var s=e.hostPermissions.concat(e.permissions);throw`ExtPay Setup Error: please include the "storage" permission in manifest.json["permissions"] or else ExtensionPay won't work correctly.

You can copy and paste this to your manifest.json file to fix this error:

"permissions": [
    ${s.map(e=>`"    ${e}"`).join(",\n")}${s.length>0?",":""}
    "storage"
]
`}}),i(["extensionpay_installed_at","extensionpay_user"]).then(async e=>{if(e.extensionpay_installed_at)return;let s=e.extensionpay_user,r=s?s.installedAt:new Date().toISOString();await g({extensionpay_installed_at:r})});let o=[],m=[];async function l(){var e,s={};if(t.management)e=await t.management.getSelf();else if(t.runtime){if(!(e=await t.runtime.sendMessage("extpay-extinfo"))){let n=!("update_url"in t.runtime.getManifest());e={installType:n?"development":"normal"}}}else throw"ExtPay needs to be run in a browser extension context";"development"==e.installType&&(s.development=!0);let i=await fetch(`${a}/api/new-key`,{method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw i.status,`${r}/home`;let o=await i.json();return await g({extensionpay_api_key:o}),o}async function A(){let e=await i(["extensionpay_api_key"]);return e.extensionpay_api_key?e.extensionpay_api_key:null}let c=/^\d\d\d\d-\d\d-\d\dT/;async function x(){var e=await i(["extensionpay_user","extensionpay_installed_at"]);let s=await A();if(!s)return{paid:!1,paidAt:null,installedAt:e.extensionpay_installed_at?new Date(e.extensionpay_installed_at):new Date,trialStartedAt:null};let r=await fetch(`${a}/api/user?api_key=${s}`,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok)throw"ExtPay error while fetching user: "+await r.text();let t=await r.json(),n={};for(var[l,x]of Object.entries(t))x&&x.match&&x.match(c)&&(x=new Date(x)),n[l]=x;return n.installedAt=new Date(e.extensionpay_installed_at),n.paidAt&&(!e.extensionpay_user||e.extensionpay_user&&!e.extensionpay_user.paidAt)&&o.forEach(e=>e(n)),n.trialStartedAt&&(!e.extensionpay_user||e.extensionpay_user&&!e.extensionpay_user.trialStartedAt)&&m.forEach(e=>e(n)),await g({extensionpay_user:t}),n}async function u(){var e=await A();return e||(e=await l()),`${a}?api_key=${e}`}async function _(e,s,r){if(t.windows&&t.windows.create){let a=await t.windows.getCurrent(),n=Math.round((a.width-s)*.5+a.left),i=Math.round((a.height-r)*.5+a.top);try{t.windows.create({url:e,type:"popup",focused:!0,width:s,height:r,left:n,top:i})}catch(g){t.windows.create({url:e,type:"popup",width:s,height:r,left:n,top:i})}}else window.open(e,null,`toolbar=no,location=no,directories=no,status=no,menubar=no,width=${s},height=${r},left=450`)}async function d(){let e=await u();_(e,500,800)}async function p(e){var s=await A();s||(s=await l());var r=`${a}/trial?api_key=${s}`;e&&(r+=`&period=${e}`),_(r,500,650)}async function f(){var e=await A();e||(e=await l());let s=`${a}/reactivate?api_key=${e}`;_(s,500,800)}var y=!1;async function h(){if(!y){y=!0;for(var e=await x(),s=0;s<120;++s){if(e.paidAt)return y=!1,e;await n(1e3),e=await x()}y=!1}}return{getUser:function(){return x()},onPaid:{addListener:function(e){let s=`"content_scripts": [
                {
            "matches": ["${r}/*"],
            "js": ["ExtPay.js"],
            "run_at": "document_start"
        }]`,a=t.runtime.getManifest();if(!a.content_scripts)throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${s}`;let n=a.content_scripts.find(e=>e.matches.includes(r.replace(":3000","")+"/*"));if(n){if(!n.run_at||"document_start"!==n.run_at)throw`ExtPay setup error: To use the onPaid callback handler, please make sure the ExtPay content script in your manifest.json runs at document start. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${s}`}else throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json matching "${r}/*". You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson

        ${s}`;o.push(e)}},openPaymentPage:d,openTrialPage:p,openLoginPage:f,onTrialStarted:{addListener:function(e){m.push(e)}},startBackground:function(){t.runtime.onMessage.addListener(function(e,s,r){if(console.log("service worker got message! Here it is:",e),"fetch-user"==e)h();else if("trial-start"==e)x();else if("extpay-extinfo"==e&&t.management)return t.management.getSelf()})}}}}();